## 언리얼 직렬화 예제

### 언리얼 구조체 직렬화

- 직렬화 시킬 구조체 operator<< 오버라이드
    
    ```cpp
    // 직렬화 처리 연산자 오버로딩.
    friend FArchive& operator<<(
        FArchive& Archive,
        FStudentData& InStudentData)
    {
        Archive << InStudentData.Order;
        Archive << InStudentData.Name;
    
        return Archive;
    }
    ```
    
- 메모리 아카이브(`FMemoryReader`, `FMemoryWriter`)를 이용해 쓰기 읽기
    
    ```cpp
    FStudentData RawDataSource(1, TEXT("김이박")); // 데이터 생성
    FString RawDataAbolutePath; // 저장 경로
    
    // -----
    // 파일 저장(쓰기)
    // -----
    
    // 아카이브 객체 생성
    FArchive* RawFileWriter = IFileManager::Get().CreateFileWriter(*RawDataAbolutePath);
    
    if (RawFileWriter)
    {
    	// 직렬화
    	*RawFileWriter << RawDataSource;
    	RawFileWriter->Close();
    	
    	// 아카이브 객체 정리
    	delete RawFileWriter;
    	RawFileWriter = nullptr;
    }
    
    if (RawFileReader)
    {
    	// 역직렬화
    	*RawFileReader << RawDataDeserialized; 
    	RawFileReader->Close();
    
    	// 아카이브 객체 정리	
    	delete RawFileReader;
    	RawFileReader = nullptr;
    }
    
    // -----
    // 파일 읽기
    // -----
    FStudentData RawDataDeserialized;
    FArchive* RawFileReader = IFileManager::Get().CreateFileReader(*RawDataAbolutePath);
    ```
    

### 언리얼 클래스 직렬화

- 클래스에 Serialize 함수 오버라이드
    
    ```cpp
    void UStudent::Serialize(FArchive& Ar)
    {
        Super::Serialize(Ar);
    
        Ar << Order;
        Ar << Name;
    }
    ```
    
- 메모리 아카이브를 이용해 쓰기 읽기. 
중간 버퍼(바이트 배열) 변환 하는 과정에 유의
    
    ```cpp
    UStudent* StudentSource = NewObject<UStudent>(); // 데이터 생성
    FString ObjectDataAbsolutePath; // 저장 경로
    
    // -----
    // 파일 저장(쓰기)
    // -----
    TUniquePtr<FArchive> FileWriter = TUniquePtr<FArchive>(IFileManager::Get().CreateFileWriter(*ObjectDataAbsolutePath));
    
    // 직렬화 
    // 다음 과정을 거침: UObject -> ByteArray -> File 
    TArray<uint8> BufferArray;
    
    // FMemoryWriter는 전달된 Byte 배열에 데이터 쓰는 기능 제공
    FMemoryWriter MemoryWriter(BufferArray);
    StudentSource->Serialize(MemoryWriter);
    
    if (FileWriter)
    {	
    	// [주의] 문제 있는 코드(UObject -> FArchive 불가) ---!
    	//*FileWriter << StudentSource; 	
    	*FileWriter << BufferArray; // 동작하는 코드
    	FileWriter->Close();
    }
    
    // -----
    // 파일 읽기
    // -----
    TUniquePtr<FArchive> FileReader = TUniquePtr<FArchive>(IFileManager::Get().CreateFileReader(*ObjectDataAbsolutePath));
    
    // 역직렬화
    // 다음 과정을 거침: File -> ByteArray -> UObject
    TArray<uint8> BufferArrayFromFile;
    
    if (FileReader)
    {
    	*FileReader << BufferArrayFromFile;
    	FileReader->Close();
    }
    
    // ByteArray -> UObject
    FMemoryReader MemoryReader(BufferArrayFromFile);
    StudentSource->Serialize(MemoryReader);
    ```